<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantitative Trading Dashboard - Live</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 42px;
            background: linear-gradient(135deg, #3b82f6, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #94a3b8;
            font-size: 16px;
        }

        .connection-status {
            background: #1e293b;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #334155;
            margin-bottom: 20px;
            text-align: center;
        }

        .connection-status.connected {
            border-color: #10b981;
            background: #10b98120;
        }

        .connection-status.disconnected {
            border-color: #ef4444;
            background: #ef444420;
        }

        .controls {
            background: #1e293b;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #334155;
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-start {
            background: #10b981;
            color: white;
        }

        .btn-start:hover:not(:disabled) {
            background: #059669;
            transform: translateY(-2px);
        }

        .btn-stop {
            background: #ef4444;
            color: white;
        }

        .btn-stop:hover:not(:disabled) {
            background: #dc2626;
            transform: translateY(-2px);
        }

        .btn-refresh {
            background: #3b82f6;
            color: white;
        }

        .btn-refresh:hover:not(:disabled) {
            background: #2563eb;
            transform: translateY(-2px);
        }

        .status {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            margin-left: auto;
        }

        .status.active {
            background: #10b98133;
            color: #10b981;
            border: 1px solid #10b981;
        }

        .status.inactive {
            background: #ef444433;
            color: #ef4444;
            border: 1px solid #ef4444;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: #1e293b;
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #334155;
            transition: transform 0.3s;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            border-color: #3b82f6;
        }

        .metric-label {
            color: #94a3b8;
            font-size: 14px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .metric-value {
            font-size: 36px;
            font-weight: bold;
            background: linear-gradient(135deg, #3b82f6, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .metric-change {
            font-size: 14px;
            margin-top: 8px;
        }

        .positive {
            color: #10b981;
        }

        .negative {
            color: #ef4444;
        }

        .chart-section {
            background: #1e293b;
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #334155;
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .icon {
            font-size: 24px;
        }

        .trade-list {
            list-style: none;
        }

        .trade-item {
            background: #0f172a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #334155;
        }

        .trade-symbol {
            font-weight: bold;
            font-size: 18px;
        }

        .trade-action {
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .trade-action.BUY {
            background: #10b98133;
            color: #10b981;
        }

        .trade-action.SELL {
            background: #ef444433;
            color: #ef4444;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }

        .spinner {
            border: 4px solid #334155;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .footer {
            text-align: center;
            color: #64748b;
            margin-top: 40px;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä Quantitative Trading Dashboard</h1>
            <p class="subtitle">Phase 3: Live Data Connected to Backend API</p>
        </header>

        <!-- Connection Status -->
        <div class="connection-status" id="connectionStatus">
            <div class="spinner"></div>
            Connecting to API...
        </div>

        <!-- Control Panel -->
        <div class="controls">
            <button class="btn-start" onclick="startTrading()" id="startBtn">‚ñ∂Ô∏è Start Trading</button>
            <button class="btn-stop" onclick="stopTrading()" id="stopBtn">‚è∏Ô∏è Stop Trading</button>
            <button class="btn-refresh" onclick="refreshData()">üîÑ Refresh Data</button>
            <div class="status inactive" id="status">‚óè Inactive</div>
        </div>

        <!-- Key Metrics -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-label">
                    <span class="icon">üí∞</span> Portfolio Value
                </div>
                <div class="metric-value" id="portfolioValue">$0</div>
                <div class="metric-change" id="portfolioChange">+0.00%</div>
            </div>

            <div class="metric-card">
                <div class="metric-label">
                    <span class="icon">üíµ</span> P&L
                </div>
                <div class="metric-value" id="pnl">$0</div>
                <div class="metric-change" id="pnlPercent">0.00%</div>
            </div>

            <div class="metric-card">
                <div class="metric-label">
                    <span class="icon">üìà</span> Alpha (Annual)
                </div>
                <div class="metric-value" id="alpha">0.00%</div>
                <div class="metric-change positive">Target: 0.5-1%</div>
            </div>

            <div class="metric-card">
                <div class="metric-label">
                    <span class="icon">‚ö°</span> Sharpe Ratio
                </div>
                <div class="metric-value" id="sharpe">0.00</div>
                <div class="metric-change positive">Risk-Adjusted</div>
            </div>

            <div class="metric-card">
                <div class="metric-label">
                    <span class="icon">‚ö†Ô∏è</span> Max Drawdown
                </div>
                <div class="metric-value" id="drawdown">0.00%</div>
                <div class="metric-change">Within Limits</div>
            </div>

            <div class="metric-card">
                <div class="metric-label">
                    <span class="icon">üéØ</span> Win Rate
                </div>
                <div class="metric-value" id="winRate">0.0%</div>
                <div class="metric-change positive">Success Rate</div>
            </div>
        </div>

        <!-- Recent Trades -->
        <div class="chart-section">
            <div class="section-title">
                <span class="icon">üíº</span> Recent Trading Activity
            </div>
            <ul class="trade-list" id="tradeList">
                <li class="loading">
                    <div class="spinner"></div>
                    Loading trades...
                </li>
            </ul>
        </div>
        <!-- Price Predictions Section -->
<div class="chart-section">
    <div class="section-title">
        <span class="icon">üîÆ</span> AI Price Predictions
    </div>
    <div style="margin-bottom: 20px;">
        <label style="color: #94a3b8;">Select Stock: </label>
        <select id="symbolSelect" onchange="loadPredictions()" style="padding: 8px; background: #0f172a; color: white; border: 1px solid #334155; border-radius: 4px;">
            <option value="AAPL">AAPL - Apple</option>
            <option value="GOOGL">GOOGL - Google</option>
            <option value="MSFT">MSFT - Microsoft</option>
            <option value="TSLA">TSLA - Tesla</option>
            <option value="AMZN">AMZN - Amazon</option>
        </select>
        <button onclick="loadPredictions()" style="margin-left: 10px; padding: 8px 16px;">üîÑ Refresh</button>
    </div>
    <div id="predictions">
        <div class="loading">
            <div class="spinner"></div>
            Loading predictions...
        </div>
    </div>
    <!-- MLOps Monitoring Section -->
<div class="chart-section">
    <div class="section-title">
        <span class="icon">üîç</span> MLOps Monitoring & Model Health
    </div>
    <div id="mlopsPanel">
        <div class="loading">
            <div class="spinner"></div>
            Loading monitoring data...
        </div>
    </div>
    <div style="margin-top: 15px; text-align: center;">
        <button onclick="loadMLOps()" class="btn-refresh">üîÑ Refresh Monitoring</button>
        <button onclick="triggerRetrain()" class="btn-start">üîÑ Trigger Retraining</button>
    </div>
</div>
</div>
        <!-- Real Market Data Section -->
<div class="chart-section">
    <div class="section-title">
        <span class="icon">üìà</span> Live Market Data
    </div>

    <div style="margin-bottom: 20px;">
        <input type="text" id="symbolInput" placeholder="Enter symbol (e.g., AAPL)"
               style="padding: 10px; background: #0f172a; color: white; border: 1px solid #334155; border-radius: 4px; width: 200px;">
        <button onclick="loadRealData()" style="padding: 10px 20px; margin-left: 10px;">üîç Get Live Data</button>
        <button onclick="loadMarketMovers()" style="padding: 10px 20px; margin-left: 10px;">üìä Market Movers</button>
    </div>

    <div id="realDataPanel">
        <div class="loading">
            <div class="spinner"></div>
            Enter a symbol to load live data...
        </div>
    </div>
</div>

        <footer class="footer">
            <p>‚úÖDashboard Connected to Live API!</p>
            <p style="margin-top: 10px;">Auto-refreshing every 5 seconds</p>
        </footer>
    </div>

    <script>
        const API_URL = 'http://localhost:8000';
        let autoRefreshInterval;

        // Check API connection on load
        async function checkConnection() {
            try {
                const response = await fetch(`${API_URL}/health`);
                const data = await response.json();

                const statusDiv = document.getElementById('connectionStatus');
                statusDiv.className = 'connection-status connected';
                statusDiv.innerHTML = '‚úÖ Connected to API Server';

                // Start auto-refresh
                startAutoRefresh();

                // Initial data load
                refreshData();
            } catch (error) {
                const statusDiv = document.getElementById('connectionStatus');
                statusDiv.className = 'connection-status disconnected';
                statusDiv.innerHTML = '‚ùå Cannot connect to API. Make sure backend is running on port 8000';
                console.error('Connection error:', error);
            }
        }

        async function startTrading() {
            try {
                const response = await fetch(`${API_URL}/trading/start`, {
                    method: 'POST'
                });
                const data = await response.json();

                showNotification('‚úÖ ' + data.message, 'success');
                refreshData();
            } catch (error) {
                showNotification('‚ùå Failed to start trading', 'error');
                console.error(error);
            }
        }

        async function stopTrading() {
            try {
                const response = await fetch(`${API_URL}/trading/stop`, {
                    method: 'POST'
                });
                const data = await response.json();

                showNotification('‚è∏Ô∏è ' + data.message, 'warning');
                refreshData();
            } catch (error) {
                showNotification('‚ùå Failed to stop trading', 'error');
                console.error(error);
            }
        }

        async function refreshData() {
            try {
                // Get health status
                const healthResponse = await fetch(`${API_URL}/health`);
                const health = await healthResponse.json();

                const statusDiv = document.getElementById('status');
                if (health.trading_active) {
                    statusDiv.className = 'status active';
                    statusDiv.textContent = '‚óè Trading Active';
                } else {
                    statusDiv.className = 'status inactive';
                    statusDiv.textContent = '‚óè Inactive';
                }

                // Get portfolio data
                const portfolioResponse = await fetch(`${API_URL}/portfolio`);
                const portfolio = await portfolioResponse.json();

                document.getElementById('portfolioValue').textContent =
                    '$' + portfolio.value.toLocaleString('en-US', {maximumFractionDigits: 0});

                document.getElementById('pnl').textContent =
                    (portfolio.pnl >= 0 ? '+$' : '-$') + Math.abs(portfolio.pnl).toLocaleString('en-US', {maximumFractionDigits: 0});

                const pnlPercentEl = document.getElementById('pnlPercent');
                pnlPercentEl.textContent = (portfolio.pnl_percent >= 0 ? '+' : '') + portfolio.pnl_percent + '%';
                pnlPercentEl.className = 'metric-change ' + (portfolio.pnl_percent >= 0 ? 'positive' : 'negative');

                const portfolioChangeEl = document.getElementById('portfolioChange');
                portfolioChangeEl.textContent = (portfolio.pnl_percent >= 0 ? '+' : '') + portfolio.pnl_percent + '%';
                portfolioChangeEl.className = 'metric-change ' + (portfolio.pnl_percent >= 0 ? 'positive' : 'negative');

                // Get metrics
                const metricsResponse = await fetch(`${API_URL}/metrics`);
                const metrics = await metricsResponse.json();

                document.getElementById('alpha').textContent = metrics.alpha + '%';
                document.getElementById('sharpe').textContent = metrics.sharpe_ratio;
                document.getElementById('drawdown').textContent = metrics.max_drawdown + '%';
                document.getElementById('winRate').textContent = metrics.win_rate + '%';

                // Get trades
                const tradesResponse = await fetch(`${API_URL}/trades?limit=10`);
                const tradesData = await tradesResponse.json();

                const tradeList = document.getElementById('tradeList');
                tradeList.innerHTML = tradesData.trades.map(trade => `
                    <li class="trade-item">
                        <div>
                            <div class="trade-symbol">${trade.symbol}</div>
                            <div style="color: #94a3b8; font-size: 14px;">
                                ${trade.quantity} shares @ $${trade.price}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <span class="trade-action ${trade.action}">${trade.action}</span>
                            <div style="color: #94a3b8; font-size: 14px; margin-top: 5px;">
                                Total: $${trade.total.toLocaleString()}
                            </div>
                        </div>
                    </li>
                `).join('');

            } catch (error) {
                console.error('Error refreshing data:', error);
            }
        }

        function startAutoRefresh() {
            // Refresh every 5 seconds
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
            autoRefreshInterval = setInterval(refreshData, 5000);
        }

        function showNotification(message, type) {
            alert(message);
        }

        // Initialize on page load
        window.addEventListener('load', checkConnection);

        // Load price predictions
async function loadPredictions() {
    const symbol = document.getElementById('symbolSelect').value;
    const predictionsDiv = document.getElementById('predictions');

    try {
        predictionsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>Loading...</div>';

        const response = await fetch(`${API_URL}/forecast/models/${symbol}?days=10`);
        const data = await response.json();

        let html = `
            <div style="background: #0f172a; padding: 20px; border-radius: 8px;">
                <h3 style="color: #3b82f6; margin-bottom: 15px;">
                    ${symbol} - Current: $${data.current_price}
                </h3>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div style="background: #1e293b; padding: 15px; border-radius: 8px;">
                        <div style="color: #94a3b8; font-size: 12px;">10-Day Forecast</div>
                        <div style="font-size: 24px; color: #10b981; font-weight: bold;">
                            $${data.ensemble_forecast[9]}
                        </div>
                        <div style="color: #64748b; font-size: 12px; margin-top: 5px;">
                            Change: ${((data.ensemble_forecast[9] - data.current_price) / data.current_price * 100).toFixed(2)}%
                        </div>
                    </div>

                    <div style="background: #1e293b; padding: 15px; border-radius: 8px;">
                        <div style="color: #94a3b8; font-size: 12px;">Confidence Range</div>
                        <div style="font-size: 16px; color: #3b82f6;">
                            $${data.confidence_intervals[9].lower} - $${data.confidence_intervals[9].upper}
                        </div>
                    </div>
                </div>

                <h4 style="margin: 20px 0 10px 0; color: #94a3b8;">Day-by-Day Forecast:</h4>
                <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px;">
        `;

        for (let i = 0; i < 10; i++) {
            const price = data.ensemble_forecast[i];
            const change = ((price - data.current_price) / data.current_price * 100).toFixed(1);
            const changeColor = change >= 0 ? '#10b981' : '#ef4444';

            html += `
                <div style="background: #1e293b; padding: 10px; border-radius: 6px; text-align: center;">
                    <div style="color: #64748b; font-size: 11px;">Day ${i + 1}</div>
                    <div style="font-size: 16px; font-weight: bold;">$${price}</div>
                    <div style="color: ${changeColor}; font-size: 11px;">${change}%</div>
                </div>
            `;
        }

        html += `
                </div>

                <h4 style="margin: 20px 0 10px 0; color: #94a3b8;">Model Breakdown:</h4>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
        `;

        const modelNames = {
            'lstm': 'LSTM Neural Net',
            'arima': 'ARIMA Statistical',
            'prophet': 'Prophet Trend',
            'moving_average': 'Moving Average'
        };

        for (const [key, name] of Object.entries(modelNames)) {
            const pred = data.individual_models[key][9];
            html += `
                <div style="background: #1e293b; padding: 10px; border-radius: 6px;">
                    <div style="color: #64748b; font-size: 12px;">${name}</div>
                    <div style="font-size: 18px; color: #3b82f6;">$${pred}</div>
                    <div style="color: #64748b; font-size: 11px;">Weight: ${(data.model_weights[key] * 100).toFixed(0)}%</div>
                </div>
            `;
        }

        html += '</div></div>';
        predictionsDiv.innerHTML = html;

    } catch (error) {
        predictionsDiv.innerHTML = '<div style="color: #ef4444;">Error loading predictions</div>';
        console.error(error);
    }
}

// Load predictions on page load
setTimeout(loadPredictions, 2000);

        // Load MLOps monitoring data
async function loadMLOps() {
    const panel = document.getElementById('mlopsPanel');

    try {
        panel.innerHTML = '<div class="loading"><div class="spinner"></div>Loading...</div>';

        const response = await fetch(`${API_URL}/mlops/dashboard`);
        const data = await response.json();

        const monitoring = data.monitoring;
        const drift = data.drift_detection;
        const retraining = data.retraining;

        // Determine status colors
        const statusColors = {
            'healthy': '#10b981',
            'warning': '#f59e0b',
            'critical': '#ef4444',
            'stable': '#10b981'
        };

        const monitorColor = statusColors[monitoring.status] || '#64748b';
        const driftColor = drift.detected ? '#ef4444' : '#10b981';

        let html = `
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <!-- Model Performance -->
                <div style="background: #0f172a; padding: 20px; border-radius: 8px; border: 2px solid ${monitorColor};">
                    <h3 style="color: ${monitorColor}; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 24px;">üìä</span> Model Performance
                    </h3>
                    <div style="color: #94a3b8; margin-bottom: 10px;">
                        Status: <strong style="color: ${monitorColor};">${monitoring.status.toUpperCase()}</strong>
                    </div>
                    <div style="color: #64748b; font-size: 14px;">${monitoring.message}</div>
        `;

        if (monitoring.current_metrics) {
            html += `
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #334155;">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                        <div>
                            <div style="color: #64748b; font-size: 12px;">RMSE</div>
                            <div style="font-size: 20px; color: #3b82f6;">${monitoring.current_metrics.rmse}</div>
                        </div>
                        <div>
                            <div style="color: #64748b; font-size: 12px;">MAE</div>
                            <div style="font-size: 20px; color: #3b82f6;">${monitoring.current_metrics.mae}</div>
                        </div>
                        <div>
                            <div style="color: #64748b; font-size: 12px;">MAPE</div>
                            <div style="font-size: 20px; color: #3b82f6;">${monitoring.current_metrics.mape}%</div>
                        </div>
                        <div>
                            <div style="color: #64748b; font-size: 12px;">Direction Acc.</div>
                            <div style="font-size: 20px; color: #10b981;">${monitoring.current_metrics.direction_accuracy}%</div>
                        </div>
                    </div>
                </div>
            `;
        }

        html += `
                    <div style="margin-top: 10px; color: #64748b; font-size: 12px;">
                        Total Predictions: ${monitoring.total_predictions || 0}
                    </div>
                </div>

                <!-- Drift Detection -->
                <div style="background: #0f172a; padding: 20px; border-radius: 8px; border: 2px solid ${driftColor};">
                    <h3 style="color: ${driftColor}; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 24px;">‚ö†Ô∏è</span> Drift Detection
                    </h3>
                    <div style="color: #94a3b8; margin-bottom: 10px;">
                        Status: <strong style="color: ${driftColor};">${drift.detected ? 'DRIFT DETECTED' : 'STABLE'}</strong>
                    </div>
                    <div style="color: #64748b; font-size: 14px; margin-bottom: 15px;">${drift.recommendation}</div>

                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px;">
                        <div>
                            <div style="color: #64748b; font-size: 12px;">PSI Score</div>
                            <div style="font-size: 20px; color: #3b82f6;">${drift.psi_score || 0}</div>
                        </div>
                        <div>
                            <div style="color: #64748b; font-size: 12px;">Confidence</div>
                            <div style="font-size: 20px; color: #3b82f6;">${drift.confidence || 0}%</div>
                        </div>
                        <div>
                            <div style="color: #64748b; font-size: 12px;">Mean Shift</div>
                            <div style="font-size: 20px; color: #f59e0b;">${drift.mean_shift || 0}</div>
                        </div>
                        <div>
                            <div style="color: #64748b; font-size: 12px;">Severity</div>
                            <div style="font-size: 16px; color: ${driftColor};">${drift.severity || 'N/A'}</div>
                        </div>
                    </div>
                </div>

                <!-- Retraining -->
                <div style="background: #0f172a; padding: 20px; border-radius: 8px; border: 2px solid #3b82f6;">
                    <h3 style="color: #3b82f6; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 24px;">üîÑ</span> Auto-Retraining
                    </h3>
                    <div style="color: #94a3b8; margin-bottom: 10px;">
                        Should Retrain: <strong style="color: ${retraining.should_retrain ? '#f59e0b' : '#10b981'};">
                            ${retraining.should_retrain ? 'YES' : 'NO'}
                        </strong>
                    </div>
        `;

        if (retraining.should_retrain) {
            html += `<div style="color: #f59e0b; font-size: 14px; margin-bottom: 15px;">‚ö†Ô∏è ${retraining.reason}</div>`;
        }

        const schedule = retraining.schedule;
        html += `
                    <div style="margin-top: 15px; color: #64748b; font-size: 13px;">
                        <div style="margin: 5px 0;">Last Retrain: ${new Date(schedule.last_retrain).toLocaleString()}</div>
                        <div style="margin: 5px 0;">Next Scheduled: ${new Date(schedule.next_scheduled).toLocaleString()}</div>
                        <div style="margin: 5px 0;">Total Retrains: ${schedule.total_retrains}</div>
                    </div>
                </div>
            </div>
        `;

        panel.innerHTML = html;

    } catch (error) {
        panel.innerHTML = '<div style="color: #ef4444;">Error loading monitoring data</div>';
        console.error(error);
    }
}

async function triggerRetrain() {
    if (!confirm('Are you sure you want to trigger model retraining?')) {
        return;
    }

    try {
        const response = await fetch(`${API_URL}/mlops/retrain`, { method: 'POST' });
        const data = await response.json();

        alert('‚úÖ Model retraining completed successfully!');
        loadMLOps(); // Refresh the panel
    } catch (error) {
        alert('‚ùå Failed to trigger retraining');
        console.error(error);
    }
}

// Load MLOps data on page load
setTimeout(loadMLOps, 3000);

        // Load real market data
async function loadRealData() {
    const symbol = document.getElementById('symbolInput').value.toUpperCase() || 'AAPL';
    const panel = document.getElementById('realDataPanel');

    try {
        panel.innerHTML = '<div class="loading"><div class="spinner"></div>Loading real data...</div>';

        // Get current price
        const priceResponse = await fetch(`${API_URL}/market/price/${symbol}`);
        const priceData = await priceResponse.json();

        // Get company info
        const infoResponse = await fetch(`${API_URL}/market/info/${symbol}`);
        const infoData = await infoResponse.json();

        // Get historical data
        const histResponse = await fetch(`${API_URL}/market/historical/${symbol}?days=5`);
        const histData = await histResponse.json();

        const changeColor = priceData.change >= 0 ? '#10b981' : '#ef4444';

        let html = `
            <div style="background: #0f172a; padding: 20px; border-radius: 8px;">
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <h2 style="color: #3b82f6; margin-bottom: 10px;">${priceData.company_name || symbol}</h2>
                        <div style="font-size: 48px; font-weight: bold; color: white; margin: 10px 0;">
                            $${priceData.price.toFixed(2)}
                        </div>
                        <div style="font-size: 20px; color: ${changeColor}; margin-bottom: 20px;">
                            ${priceData.change >= 0 ? '+' : ''}${priceData.change.toFixed(2)}
                            (${priceData.change_percent >= 0 ? '+' : ''}${priceData.change_percent.toFixed(2)}%)
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr; gap: 10px;">
                        <div style="background: #1e293b; padding: 15px; border-radius: 8px;">
                            <div style="color: #64748b; font-size: 12px;">Market Cap</div>
                            <div style="font-size: 18px; color: #3b82f6;">
                                $${(priceData.market_cap / 1e9).toFixed(2)}B
                            </div>
                        </div>
                        <div style="background: #1e293b; padding: 15px; border-radius: 8px;">
                            <div style="color: #64748b; font-size: 12px;">P/E Ratio</div>
                            <div style="font-size: 18px; color: #3b82f6;">
                                ${priceData.pe_ratio ? priceData.pe_ratio.toFixed(2) : 'N/A'}
                            </div>
                        </div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px;">
                    <div style="background: #1e293b; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="color: #64748b; font-size: 12px;">Open</div>
                        <div style="font-size: 18px; font-weight: bold;">$${priceData.open.toFixed(2)}</div>
                    </div>
                    <div style="background: #1e293b; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="color: #64748b; font-size: 12px;">High</div>
                        <div style="font-size: 18px; font-weight: bold; color: #10b981;">$${priceData.high.toFixed(2)}</div>
                    </div>
                    <div style="background: #1e293b; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="color: #64748b; font-size: 12px;">Low</div>
                        <div style="font-size: 18px; font-weight: bold; color: #ef4444;">$${priceData.low.toFixed(2)}</div>
                    </div>
                    <div style="background: #1e293b; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="color: #64748b; font-size: 12px;">Volume</div>
                        <div style="font-size: 18px; font-weight: bold;">${(priceData.volume / 1e6).toFixed(2)}M</div>
                    </div>
                </div>

                <div style="background: #1e293b; padding: 15px; border-radius: 8px;">
                    <h4 style="margin-bottom: 10px; color: #94a3b8;">Company Info</h4>
                    <div style="color: #64748b; font-size: 14px; line-height: 1.6;">
                        <div><strong>Sector:</strong> ${infoData.sector || 'N/A'}</div>
                        <div><strong>Industry:</strong> ${infoData.industry || 'N/A'}</div>
                        <div><strong>52 Week High:</strong> $${infoData['52_week_high'] || 'N/A'}</div>
                        <div><strong>52 Week Low:</strong> $${infoData['52_week_low'] || 'N/A'}</div>
                    </div>
                </div>
            </div>
        `;

        panel.innerHTML = html;

        // Also update the prediction dropdown to this symbol
        document.getElementById('symbolSelect').value = symbol;
        loadPredictions();

    } catch (error) {
        panel.innerHTML = '<div style="color: #ef4444;">Error loading real market data. Make sure the symbol is valid.</div>';
        console.error(error);
    }
}

async function loadMarketMovers() {
    const panel = document.getElementById('realDataPanel');

    try {
        panel.innerHTML = '<div class="loading"><div class="spinner"></div>Loading market movers...</div>';

        const response = await fetch(`${API_URL}/market/movers`);
        const data = await response.json();

        let html = '<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">';

        // Top Gainers
        html += '<div style="background: #0f172a; padding: 20px; border-radius: 8px; border: 2px solid #10b981;">';
        html += '<h3 style="color: #10b981; margin-bottom: 15px;">üìà Top Gainers</h3>';
        data.gainers.forEach(stock => {
            html += `
                <div style="background: #1e293b; padding: 10px; margin-bottom: 10px; border-radius: 6px;">
                    <div style="font-weight: bold;">${stock.symbol}</div>
                    <div style="font-size: 14px; color: #94a3b8;">${stock.name}</div>
                    <div style="font-size: 18px; color: #10b981; margin-top: 5px;">
                        +${stock.change_percent.toFixed(2)}%
                    </div>
                </div>
            `;
        });
        html += '</div>';

        // Top Losers
        html += '<div style="background: #0f172a; padding: 20px; border-radius: 8px; border: 2px solid #ef4444;">';
        html += '<h3 style="color: #ef4444; margin-bottom: 15px;">üìâ Top Losers</h3>';
        data.losers.forEach(stock => {
            html += `
                <div style="background: #1e293b; padding: 10px; margin-bottom: 10px; border-radius: 6px;">
                    <div style="font-weight: bold;">${stock.symbol}</div>
                    <div style="font-size: 14px; color: #94a3b8;">${stock.name}</div>
                    <div style="font-size: 18px; color: #ef4444; margin-top: 5px;">
                        ${stock.change_percent.toFixed(2)}%
                    </div>
                </div>
            `;
        });
        html += '</div>';

        // Most Active
        html += '<div style="background: #0f172a; padding: 20px; border-radius: 8px; border: 2px solid #3b82f6;">';
        html += '<h3 style="color: #3b82f6; margin-bottom: 15px;">üî• Most Active</h3>';
        data.most_active.forEach(stock => {
            html += `
                <div style="background: #1e293b; padding: 10px; margin-bottom: 10px; border-radius: 6px;">
                    <div style="font-weight: bold;">${stock.symbol}</div>
                    <div style="font-size: 14px; color: #94a3b8;">${stock.name}</div>
                    <div style="font-size: 14px; color: #3b82f6; margin-top: 5px;">
                        Vol: ${(stock.volume / 1e6).toFixed(1)}M
                    </div>
                </div>
            `;
        });
        html += '</div>';

        html += '</div>';
        panel.innerHTML = html;

    } catch (error) {
        panel.innerHTML = '<div style="color: #ef4444;">Error loading market movers</div>';
        console.error(error);
    }
}

// Load AAPL data by default after 4 seconds
setTimeout(() => {
    document.getElementById('symbolInput').value = 'AAPL';
    loadRealData();
}, 4000);
    </script>
</body>
</html>